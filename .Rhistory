scalvec<-data.frame(FloristicSurveyLDA$scaling)
# Extract predictions
FloristicSurveyLDAval <- data.frame(predict(FloristicSurveyLDA)$x)
# Plot results
ggplot(data=FloristicSurveyLDAval,aes(x=LD1, y=LD2, group=FloristicSurveysmall$GM_Coverage_category))+
stat_ellipse(geom="polygon",aes(colour=FloristicSurveysmall$GM_Coverage_category),fill=NA,size=1.2,alpha=0.3)+
stat_ellipse(geom="polygon",aes(fill=FloristicSurveysmall$GM_Coverage_category,colour=FloristicSurveysmall$GM_Coverage_category),size=1.2,alpha=0.3)+
geom_point(aes(shape=FloristicSurveysmall$GM_Coverage_category,fill=FloristicSurveysmall$GM_Coverage_category,colour=FloristicSurveysmall$GM_Coverage_category),size=I(4),alpha=I(0.8))+
xlab("LD Axis 1")+ylab("LD Axis 2")+theme_simple() +
theme(legend.title=element_blank())
lda(GM_Coverage_category ~., data=FloristicSurveysmall)
FloristicSurveyLDA <- lda(GM_Coverage_category ~., data=FloristicSurveysmall)
# Extract scaling vectors
scalvec<-data.frame(FloristicSurveyLDA$scaling)
# Plot results
ggplot(data=FloristicSurveyLDAval,aes(x=LD1, y=LD2, group=FloristicSurveysmall$GM_Coverage_category))+
stat_ellipse(geom="polygon",aes(colour=FloristicSurveysmall$GM_Coverage_category),fill=NA,size=1.2,alpha=0.3)+
stat_ellipse(geom="polygon",aes(fill=FloristicSurveysmall$GM_Coverage_category,colour=FloristicSurveysmall$GM_Coverage_category),size=1.2,alpha=0.3)+
geom_point(aes(shape=FloristicSurveysmall$GM_Coverage_category,fill=FloristicSurveysmall$GM_Coverage_category,colour=FloristicSurveysmall$GM_Coverage_category),size=I(4),alpha=I(0.8))+
xlab("LD Axis 1")+ylab("LD Axis 2")+theme_simple() +
theme(legend.title=element_blank())
# Extract predictions
FloristicSurveyLDAval <- data.frame(predict(FloristicSurveyLDA)$x)
# Plot results
ggplot(data=FloristicSurveyLDAval,aes(x=LD1, y=LD2, group=FloristicSurveysmall$GM_Coverage_category))+
stat_ellipse(geom="polygon",aes(colour=FloristicSurveysmall$GM_Coverage_category),fill=NA,size=1.2,alpha=0.3)+
stat_ellipse(geom="polygon",aes(fill=FloristicSurveysmall$GM_Coverage_category,colour=FloristicSurveysmall$GM_Coverage_category),size=1.2,alpha=0.3)+
geom_point(aes(shape=FloristicSurveysmall$GM_Coverage_category,fill=FloristicSurveysmall$GM_Coverage_category,colour=FloristicSurveysmall$GM_Coverage_category),size=I(4),alpha=I(0.8))+
xlab("LD Axis 1")+ylab("LD Axis 2")+theme_simple() +
theme(legend.title=element_blank())
length(FloristicSurveyLDAval$LD1)
# Plot results
ggplot(data=FloristicSurveyLDAval,aes(x=LD1, y=LD2, group=FloristicSurveysmall$GM_Coverage_category[1:189]))+
stat_ellipse(geom="polygon",aes(colour=FloristicSurveysmall$GM_Coverage_category[1:189]),fill=NA,size=1.2,alpha=0.3)+
stat_ellipse(geom="polygon",aes(fill=FloristicSurveysmall$GM_Coverage_category[1:189],colour=FloristicSurveysmall$GM_Coverage_category),size=1.2,alpha=0.3)+
geom_point(aes(shape=FloristicSurveysmall$GM_Coverage_category[1:189],fill=FloristicSurveysmall$GM_Coverage_category,colour=FloristicSurveysmall$GM_Coverage_category[1:189]),size=I(4),alpha=I(0.8))+
xlab("LD Axis 1")+ylab("LD Axis 2")+theme_simple() +
theme(legend.title=element_blank())
# Plot results
ggplot(data=FloristicSurveyLDAval,aes(x=LD1, y=LD2, group=FloristicSurveysmall$GM_Coverage_category[1:189]))+
stat_ellipse(geom="polygon",aes(colour=FloristicSurveysmall$GM_Coverage_category[1:189]),fill=NA,size=1.2,alpha=0.3)+
stat_ellipse(geom="polygon",aes(fill=FloristicSurveysmall$GM_Coverage_category[1:189],colour=FloristicSurveysmall$GM_Coverage_category),size=1.2,alpha=0.3)+
geom_point(aes(shape=FloristicSurveysmall$GM_Coverage_category[1:189],fill=FloristicSurveysmall$GM_Coverage_category[1:189],colour=FloristicSurveysmall$GM_Coverage_category[1:189]),size=I(4),alpha=I(0.8))+
xlab("LD Axis 1")+ylab("LD Axis 2")+theme_simple() +
theme(legend.title=element_blank())
FloristicSurveysmall$GM_Coverage_category[1:189]
ggplot(data=FloristicSurveyLDAval,aes(x=LD1, y=LD2, group=FloristicSurveysmall$GM_Coverage_category[1:189]))+
stat_ellipse(geom="polygon",aes(colour=FloristicSurveysmall$GM_Coverage_category[1:189]),fill=NA,size=1.2,alpha=0.3)+
stat_ellipse(geom="polygon",aes(fill=FloristicSurveysmall$GM_Coverage_category[1:189],colour=FloristicSurveysmall$GM_Coverage_category),size=1.2,alpha=0.3)+
geom_point(aes(shape=FloristicSurveysmall$GM_Coverage_category[1:189],fill=FloristicSurveysmall$GM_Coverage_category[1:189],colour=FloristicSurveysmall$GM_Coverage_category[1:189]),size=I(4),alpha=I(0.8))+
xlab("LD Axis 1")+ylab("LD Axis 2")+theme_simple() +
theme(legend.title=element_blank())
# Plot results
ggplot(data=FloristicSurveyLDAval,aes(x=LD1, y=LD2, group=FloristicSurveysmall$GM_Coverage_category[1:189]))+
stat_ellipse(geom="polygon",aes(colour=FloristicSurveysmall$GM_Coverage_category[1:189]),fill=NA,size=1.2,alpha=0.3)+
stat_ellipse(geom="polygon",aes(fill=FloristicSurveysmall$GM_Coverage_category[1:189],colour=FloristicSurveysmall$GM_Coverage_category[1:189]),size=1.2,alpha=0.3)+
geom_point(aes(shape=FloristicSurveysmall$GM_Coverage_category[1:189],fill=FloristicSurveysmall$GM_Coverage_category[1:189],colour=FloristicSurveysmall$GM_Coverage_category[1:189]),size=I(4),alpha=I(0.8))+
xlab("LD Axis 1")+ylab("LD Axis 2")+theme_simple() +
theme(legend.title=element_blank())
# Discriminant function analysis is used (general LDA format) because i have a cat. dependent and a binary independent. (it needs binary or continuous!)
# you might have to bin covers because it only works with categorical, so 0-5% none, 6-40 low etc.
FloristicSurvey$GM_Coverage_category<-cut(FloristicSurvey$GM_Coverage, c(-Inf,20,50,80,100), labels = c("None", "Low", "Med_Low", "Med_High", "High", "Overtaken"))
# Discriminant function analysis is used (general LDA format) because i have a cat. dependent and a binary independent. (it needs binary or continuous!)
# you might have to bin covers because it only works with categorical, so 0-5% none, 6-40 low etc.
FloristicSurvey$GM_Coverage_category<-cut(FloristicSurvey$GM_Coverage, c(-Inf,20,50,80,100), labels = c("None", "Med_Low", "Med_High", "Overtaken"))
# Discriminant function analysis is used (general LDA format) because i have a cat. dependent and a binary independent. (it needs binary or continuous!)
# you might have to bin covers because it only works with categorical, so 0-5% none, 6-40 low etc.
FloristicSurvey$GM_Coverage_category<-cut(FloristicSurvey$GM_Coverage, c(-Inf,20,50,80,100), labels = c("None", "Med_Low", "Med_High", "Overtaken"))
#LDA
FloristicSurveysmall<-data.frame(FloristicSurvey[,4:56])
#LDA
FloristicSurveysmall<-data.frame(FloristicSurvey[,4:56])
FloristicSurveysmall[,c(42,45)] <- FloristicSurveysmall[,-c(42,45)]
FloristicSurveysmall[,c(42,45)] <- FloristicSurveysmall[,-c(42,45)]
FloristicSurveysmall[,c(42,45)] <- FloristicSurveysmall[,-c(42,45)]
FloristicSurveyLDA <- lda(GM_Coverage_category ~., data=FloristicSurveysmall)
# Extract scaling vectors
scalvec<-data.frame(FloristicSurveyLDA$scaling)
# Extract predictions
FloristicSurveyLDAval <- data.frame(predict(FloristicSurveyLDA)$x)
# Plot results
ggplot(data=FloristicSurveyLDAval,aes(x=LD1, y=LD2, group=FloristicSurveysmall$GM_Coverage_category[1:189]))+
stat_ellipse(geom="polygon",aes(colour=FloristicSurveysmall$GM_Coverage_category[1:189]),fill=NA,size=1.2,alpha=0.3)+
stat_ellipse(geom="polygon",aes(fill=FloristicSurveysmall$GM_Coverage_category[1:189],colour=FloristicSurveysmall$GM_Coverage_category[1:189]),size=1.2,alpha=0.3)+
geom_point(aes(shape=FloristicSurveysmall$GM_Coverage_category[1:189],fill=FloristicSurveysmall$GM_Coverage_category[1:189],colour=FloristicSurveysmall$GM_Coverage_category[1:189]),size=I(4),alpha=I(0.8))+
xlab("LD Axis 1")+ylab("LD Axis 2")+theme_simple() +
theme(legend.title=element_blank())
#test significance of axis
anova(lm(FloristicSurveyLDAval$LD1~FloristicSurveysmall$GM_Coverage_category))
#test significance of axis
anova(lm(FloristicSurveyLDAval$LD1~FloristicSurveysmall$GM_Coverage_category[1:189]))
anova(lm(FloristicSurveyLDAval$LD2~FloristicSurveysmall$GM_Coverage_category[1:189]))
#LDA WITHOUT A. PETIOLATA
FloristicSurveysmall<-data.frame(FloristicSurvey[,4:56])
# Linear discriminant function analysis
FloristicSurveysmall[10]<-NULL
(FloristicSurveyLDA<-lda(GM_Coverage_category ~ ., data=FloristicSurveysmall))
FloristicSurveysmall[c(42,45)] <- FloristicSurveysmall[-c(42,45)]
FloristicSurveyLDA <- lda(GM_Coverage_category ~., data=FloristicSurveysmall)
FloristicSurveysmall[c(42,45)] <- FloristicSurveysmall[,-c(42,45)]
FloristicSurveyLDA <- lda(GM_Coverage_category ~., data=FloristicSurveysmall)
FloristicSurveysmall[,c(42,45)] <- FloristicSurveysmall[,-c(42,45)]
FloristicSurveyLDA <- lda(GM_Coverage_category ~., data=FloristicSurveysmall)
#LDA
FloristicSurveysmall<-data.frame(FloristicSurvey[,4:56])
FloristicSurveysmall[,c(42,45)] <- FloristicSurveysmall[,-c(42,45)]
FloristicSurveyLDA <- lda(GM_Coverage_category ~., data=FloristicSurveysmall)
#LDA
FloristicSurveysmall<-data.frame(FloristicSurvey[,4:56])
FloristicSurveysmall[,c(42,45)] <- FloristicSurveysmall[,-c(42,45)]
#LDA
FloristicSurveysmall<-data.frame(FloristicSurvey[,4:56])
FloristicSurveysmall <- FloristicSurveysmall[,-c(42,45)]
FloristicSurveyLDA <- lda(GM_Coverage_category ~., data=FloristicSurveysmall)
# Extract scaling vectors
scalvec<-data.frame(FloristicSurveyLDA$scaling)
# Extract predictions
FloristicSurveyLDAval <- data.frame(predict(FloristicSurveyLDA)$x)
# Plot results
ggplot(data=FloristicSurveyLDAval,aes(x=LD1, y=LD2, group=FloristicSurveysmall$GM_Coverage_category[1:189]))+
stat_ellipse(geom="polygon",aes(colour=FloristicSurveysmall$GM_Coverage_category[1:189]),fill=NA,size=1.2,alpha=0.3)+
stat_ellipse(geom="polygon",aes(fill=FloristicSurveysmall$GM_Coverage_category[1:189],colour=FloristicSurveysmall$GM_Coverage_category[1:189]),size=1.2,alpha=0.3)+
geom_point(aes(shape=FloristicSurveysmall$GM_Coverage_category[1:189],fill=FloristicSurveysmall$GM_Coverage_category[1:189],colour=FloristicSurveysmall$GM_Coverage_category[1:189]),size=I(4),alpha=I(0.8))+
xlab("LD Axis 1")+ylab("LD Axis 2")+theme_simple() +
theme(legend.title=element_blank())
#LDA
FloristicSurveysmall<-data.frame(FloristicSurvey[,4:56])
FloristicSurveysmall <- FloristicSurveysmall[,-c(42,45)]
FloristicSurveyLDA <- lda(GM_Coverage_category ~., data=FloristicSurveysmall)
# Extract scaling vectors
scalvec<-data.frame(FloristicSurveyLDA$scaling)
# Extract predictions
FloristicSurveyLDAval <- data.frame(predict(FloristicSurveyLDA)$x)
# Plot results
ggplot(data=FloristicSurveyLDAval,aes(x=LD1, y=LD2, group=FloristicSurveysmall$GM_Coverage_category[1:189]))+
stat_ellipse(geom="polygon",aes(colour=FloristicSurveysmall$GM_Coverage_category[1:189]),fill=NA,size=1.2,alpha=0.3)+
stat_ellipse(geom="polygon",aes(fill=FloristicSurveysmall$GM_Coverage_category[1:189],colour=FloristicSurveysmall$GM_Coverage_category[1:189]),size=1.2,alpha=0.3)+
geom_point(aes(shape=FloristicSurveysmall$GM_Coverage_category[1:189],fill=FloristicSurveysmall$GM_Coverage_category[1:189],colour=FloristicSurveysmall$GM_Coverage_category[1:189]),size=I(4),alpha=I(0.8))+
xlab("LD Axis 1")+ylab("LD Axis 2")+theme_simple() +
theme(legend.title=element_blank())
#test significance of axis
anova(lm(FloristicSurveyLDAval$LD1~FloristicSurveysmall$GM_Coverage_category[1:189]))
anova(lm(FloristicSurveyLDAval$LD2~FloristicSurveysmall$GM_Coverage_category[1:189]))
#LDA WITHOUT A. PETIOLATA
FloristicSurveysmall<-data.frame(FloristicSurvey[,4:56])
# Linear discriminant function analysis
FloristicSurveysmall[10]<-NULL
(FloristicSurveyLDA<-lda(GM_Coverage_category ~ ., data=FloristicSurveysmall))
FloristicSurveysmall[c(41,44)] <- NULL
FloristicSurveyLDA<-lda(GM_Coverage_category ~ ., data=FloristicSurveysmall)
# Extract scaling vectors
scalvec<-data.frame(FloristicSurveyLDA$scaling)
# Extract predictions
FloristicSurveyLDAval <- data.frame(predict(FloristicSurveyLDA)$x)
par(mar = rep(2, 4))
ldahist(data = FloristicSurveyLDAval[,1], g=FloristicSurveysmall$GM_Coverage_category)
# Plot results
p<-ggplot(data=FloristicSurveyLDAval,aes(x=LD1,y=LD2,group=FloristicSurveysmall$GM_Coverage_category))+
stat_ellipse(geom="polygon",aes(colour=FloristicSurveysmall$GM_Coverage_category),fill=NA,size=1.2,alpha=0.3)+
stat_ellipse(geom="polygon",aes(fill=FloristicSurveysmall$GM_Coverage_category,colour=FloristicSurveysmall$GM_Coverage_category),size=1.2,alpha=0.3)+
geom_point(aes(shape=FloristicSurveysmall$GM_Coverage_category,fill=FloristicSurveysmall$GM_Coverage_category,colour=FloristicSurveysmall$GM_Coverage_category),size=I(4),alpha=I(0.8))+
xlab("LD Axis 1")+ylab("LD Axis 2")+theme_simple() +
theme(legend.title=element_blank())
print(p)
length(FloristicSurveysmall$GM_Coverage_category)
# Plot results
p<-ggplot(data=FloristicSurveyLDAval,aes(x=LD1,y=LD2,group=FloristicSurveysmall$GM_Coverage_category[1:189]))+
stat_ellipse(geom="polygon",aes(colour=FloristicSurveysmall$GM_Coverage_category[1:189]),fill=NA,size=1.2,alpha=0.3)+
stat_ellipse(geom="polygon",aes(fill=FloristicSurveysmall$GM_Coverage_category[1:189],colour=FloristicSurveysmall$GM_Coverage_category[1:189]),size=1.2,alpha=0.3)+
geom_point(aes(shape=FloristicSurveysmall$GM_Coverage_category[1:189],fill=FloristicSurveysmall$GM_Coverage_category[1:189],colour=FloristicSurveysmall$GM_Coverage_category[1:189]),size=I(4),alpha=I(0.8))+
xlab("LD Axis 1")+ylab("LD Axis 2")+theme_simple() +
theme(legend.title=element_blank())
print(p)
# Plot results
ggplot(data=FloristicSurveyLDAval,aes(x=LD1,y=LD2,group=FloristicSurveysmall$GM_Coverage_category[1:189]))+
stat_ellipse(geom="polygon",aes(colour=FloristicSurveysmall$GM_Coverage_category[1:189]),fill=NA,size=1.2,alpha=0.3)+
stat_ellipse(geom="polygon",aes(fill=FloristicSurveysmall$GM_Coverage_category[1:189],colour=FloristicSurveysmall$GM_Coverage_category[1:189]),size=1.2,alpha=0.3)+
geom_point(aes(shape=FloristicSurveysmall$GM_Coverage_category[1:189],fill=FloristicSurveysmall$GM_Coverage_category[1:189],colour=FloristicSurveysmall$GM_Coverage_category[1:189]),size=I(4),alpha=I(0.8))+
xlab("LD Axis 1")+ylab("LD Axis 2")+theme_simple() +
theme(legend.title=element_blank())
#test significance of axis
anova(lm(FloristicSurveyLDAval$LD1~FloristicSurveysmall$GM_Coverage_category[1:189]))
anova(lm(FloristicSurveyLDAval$LD2~FloristicSurveysmall$GM_Coverage_category[1:189]))
# Ward Hierarchical Clustering with Bootstrapped p values
#do they cluster by population?
FloristicSurvey[is.na(FloristicSurvey)] <- 0
mydata<-t(data.frame(FloristicSurvey[,1],FloristicSurvey[,4:55]))
my.names <- mydata[1,]
colnames(mydata) <- my.names
mydata <- mydata[-1,]
d <- dist(t(mydata), method = "euclidean") # distance matrix
fit <- hclust(d, method = "ward.D")
plot(fit)
#do they cluster by GM coverage?
FloristicSurvey[is.na(FloristicSurvey)] <- 0
#this will just make the dendogram easier to see
FloristicSurvey$GM_Coverage_category<-cut(FloristicSurvey$GM_Coverage, c(-Inf,5,30,50,70,95,100), labels = c("N", "L", "ML", "MH", "H", "F"))
mydata<-t(data.frame(FloristicSurvey[,56],FloristicSurvey[,4:55]))
my.names <- mydata[1,]
colnames(mydata) <- my.names
mydata <- mydata[-1,]
d <- dist(t(mydata), method = "euclidean") # distance matrix
fit <- hclust(d, method = "ward.D")
plot(fit)
plot(fit)
FloristicSurvey$GM_Coverage_category<-cut(FloristicSurvey$GM_Coverage, c(-Inf,5,30,50,70,95,100), labels = c("None", "Low", "Med_Low", "Med_High", "High", "Overtaken"))
FloristicSurvey$GM_Coverage_category<-cut(FloristicSurvey$GM_Coverage, c(-Inf,5,30,50,70,95,100), labels = c("None", "Low", "Med_Low", "Med_High", "High", "Overtaken"))
####Bootleg way to PCA####
M <- as.matrix(FloristicSurvey[1:198,4:52])
M[is.na(M)] <- 0
f$groups <- c(rep(1,72),rep(72,94))
myPCA <- prcomp(M, scale. = F, center = F)
f$groups <- c(rep(1,72),rep(72,94))
####Bootleg way to PCA####
M <- as.matrix(FloristicSurvey[1:198,4:52])
M[is.na(M)] <- 0
myPCA <- prcomp(M, scale. = F, center = F)
plot(myPCA$x)
PCs<-cbind(FloristicSurvey[,1:3],myPCA$x)
PCs<-cbind(FloristicSurvey[,1:3],myPCA$x)
plot(myPCA$x)
# https://jonlefcheck.net/2012/10/24/nmds-tutorial-in-r/
# https://oliviarata.wordpress.com/2014/04/17/ordinations-in-ggplot2/
#Make a matrix with no row or column equal to 0 (do not enclude the env variable (GM COVERAGE))
M <- as.matrix(FloristicSurvey[1:198,4:55])
M[is.na(M)] <- 0
rownames(M) <- FloristicSurvey$Population
which( colSums(M)==0 )
which( rowSums(M)==0 )
#Now that you know which column must be taken out, redo the matrix but with the last column, then remove the rows and columns =0
#I did this because the previous method doesnt work with the characters in the GM_COVERAGE column.
M <- as.matrix(FloristicSurvey[1:198,4:56])
M[is.na(M)] <- 0
rownames(M) <- FloristicSurvey$Population
M<-M[,-45]
M<-M[-130,]
M<-M[-133,]
M<-M[-132,]
# Now I'll make the env column a vector on its own, but the previous colde now allows it to be in the same order as the matrix im using for distances.
GM_coverage_df <- data.frame(M[,52])
M<-M[,-52]
class(M) <- "numeric"
# with vegdist from Bray to seroeson: add binary = T
dist_FloristicSurvey <- vegdist(M, method = "bray", binary = T)
#The metaMDS analysis could have done the distance matrix internally but i would rather control it since i have presence/abscence
meta.nmds.FloristicSurvey <- metaMDS(dist_FloristicSurvey)
# with vegdist from Bray to seroeson: add binary = T
dist_FloristicSurvey <- vegdist(M, method = "bray", binary = T)
library("vegan", lib.loc="/Library/Frameworks/R.framework/Versions/3.4/Resources/library")
# with vegdist from Bray to seroeson: add binary = T
dist_FloristicSurvey <- vegdist(M, method = "bray", binary = T)
#The metaMDS analysis could have done the distance matrix internally but i would rather control it since i have presence/abscence
meta.nmds.FloristicSurvey <- metaMDS(dist_FloristicSurvey)
#The metaMDS analysis could have done the distance matrix internally but i would rather control it since i have presence/abscence
meta.nmds.FloristicSurvey <- metaMDS(dist_FloristicSurvey)
# Non convergence with only 20 tries. lets increase that then
meta.nmds.FloristicSurvey2D <- metaMDS(dist_FloristicSurvey, k=2, trymax = 1000)
str(meta.nmds.FloristicSurvey2D)
stressplot(meta.nmds.FloristicSurvey2D)
# Im getting a little above a stress of 0.2 (0.207), which isnt ideal, ill try it again with 3 dimension
# A good rule of thumb: stress < 0.05 provides an excellent representation in reduced dimensions, < 0.1 is great, < 0.2 is good/ok, and stress < 0.3 provides a poor representation.
meta.nmds.FloristicSurvey3D <- metaMDS(dist_FloristicSurvey, k=3, trymax = 1000)
str(meta.nmds.FloristicSurvey3D)
# stress is lower! 0.146
stressplot(meta.nmds.FloristicSurvey3D)
# envfit for the 2D
FloristicSurvey_envfit <- envfit(meta.nmds.FloristicSurvey2D, env = GM_coverage_df, perm = 999) #standard envfit
FloristicSurvey_envfit
FloristicSurvey_envfit
#data for plotting
##NMDS points
FloristicSurvey.NMDS.data<-GM_coverage_df
FloristicSurvey.NMDS.data$NMDS1<-meta.nmds.FloristicSurvey2D$points[ ,1]
FloristicSurvey.NMDS.data$NMDS2<-meta.nmds.FloristicSurvey2D$points[ ,2]
colnames(FloristicSurvey.NMDS.data)[1] <- "GM_Coverage"
# data for the envfit arrows
env.scores.FloristicSurvey <- as.data.frame(scores(FloristicSurvey_envfit, display = "vectors")) #extracts relevant scores from envifit
env.scores.FloristicSurvey <- cbind(env.scores.FloristicSurvey, env.variables = rownames(env.scores.FloristicSurvey)) #and then gives them their names
# function for ellipsess - just run this, is used later
#taken from the excellent stackoverflow Q+A: http://stackoverflow.com/questions/13794419/plotting-ordiellipse-function-from-vegan-package-onto-nmds-plot-created-in-ggplo
veganCovEllipse <- function (cov, center = c(0, 0), scale = 1, npoints = 100)
{
theta <- (0:npoints) * 2 * pi/npoints
Circle <- cbind(cos(theta), sin(theta))
t(center + scale * t(Circle %*% chol(cov)))
}
#data for ellipse, use GM coverage
df_ell.FSurvey.GM_coverage <- data.frame() #sets up a data frame before running the function.
for(g in levels(FloristicSurvey.NMDS.data$GM_Coverage)){
df_ell.FSurvey.GM_coverage <- rbind(df_ell.FSurvey.GM_coverage, cbind(as.data.frame(with(FloristicSurvey.NMDS.data [FloristicSurvey.NMDS.data$GM_Coverage==g,],
veganCovEllipse(cov.wt(cbind(NMDS1,NMDS2),wt=rep(1/length(NMDS1),length(NMDS1)))$cov,center=c(mean(NMDS1),mean(NMDS2)))))
,GM_coverage=g))
}
for(g in levels(FloristicSurvey.NMDS.data$GM_Coverage)){
df_ell.FSurvey.GM_coverage <- rbind(df_ell.FSurvey.GM_coverage, cbind(as.data.frame(with(FloristicSurvey.NMDS.data [FloristicSurvey.NMDS.data$GM_Coverage==g,],
veganCovEllipse(cov.wt(cbind(NMDS1,NMDS2),wt=rep(1/length(NMDS1),length(NMDS1)))$cov,center=c(mean(NMDS1),mean(NMDS2)))))
,GM_coverage=g))
}
# data for labelling the ellipse
NMDS.mean.FloristicSurvey=aggregate(FloristicSurvey.NMDS.data[ ,c("NMDS1", "NMDS2")],
list(group = FloristicSurvey.NMDS.data$GM_Coverage), mean)
## finally plotting.
mult <- 1 #multiplier for the arrows and text for envfit below. You can change this and then rerun the plot command.
(FloristicSurvey.nmds.gg1 <- ggplot(data = FloristicSurvey.NMDS.data, aes(y = NMDS2, x = NMDS1))+ #sets up the plot. brackets around the entire thing to make it draw automatically
geom_path(data = df_ell.FSurvey.GM_coverage, aes(x = NMDS1, y = NMDS2, group = df_ell.FSurvey.GM_coverage$GM_coverage, alpha=df_ell.FSurvey.GM_coverage$GM_coverage))+ #this is the ellipse, seperate ones by Site. If you didn't change the "alpha" (the shade) then you need to keep the "group
scale_alpha_manual(guide = FALSE,values=c(0.3, 0.5, 0.6, 0.7, 0.8, 0.9))+ #sets the shade for the ellipse
geom_point( aes(shape = FloristicSurvey.NMDS.data$GM_Coverage), size = 1) + #puts the site points in from the ordination, shape determined by site, size refers to size of point
# geom_text(data=spps2, aes(x=spps2$NMDS1, y=spps2$NMDS2, label=species), size = 3.3, hjust=1.1)+ #labelling the species. hjust used to shift them slightly from their points
#annotate("text",x = NMDS.mean$NMDS1,y = NMDS.mean$NMDS2,label=NMDS.mean$group) + #labels for the centroids - I haven't used this since we have a legend. but you could also dithc the legend, but plot will get v messy
#geom_segment(data = env.scores.FloristicSurvey,
#             aes(x = 0, xend = mult*env.scores.FloristicSurvey$NMDS1, y = 0, yend = mult*env.scores.FloristicSurvey$NMDS2),
#             arrow = arrow(length = unit(0.25, "cm")), colour = "grey") + #arrows for envfit.  doubled the length for similarity to the plot() function. NB check ?envfit regarding arrow length if not familiar with lengths
#geom_text(data = env.scores.FloristicSurvey, #labels the environmental variable arrows * "mult" as for the arrows
#          aes(x = mult*env.scores.FloristicSurvey$NMDS1, y = mult*env.scores.FloristicSurvey$NMDS2, label=env.variables),
#          size = 5,
#          hjust = -0.5)+
scale_shape_manual(values = c(1,8,19,5,6,7))+ #sets the shape of the plot points instead of using whatever ggplot2 automatically provides
coord_cartesian(xlim = c(-1,1.5))+  ## NB this changes the visible area of the plot only (this is a good thing, apparently). Can also specify ylim. Here in case you want to set xaxis manually.
theme_simple())
FloristicSurvey.NMDS.data$GM_Coverage
#LDA
FloristicSurveysmall<-data.frame(FloristicSurvey[,4:56])
FloristicSurveysmall <- FloristicSurveysmall[,-c(42,45)]
FloristicSurveyLDA <- lda(GM_Coverage_category ~., data=FloristicSurveysmall)
# Extract scaling vectors
scalvec<-data.frame(FloristicSurveyLDA$scaling)
# Extract predictions
FloristicSurveyLDAval <- data.frame(predict(FloristicSurveyLDA)$x)
# Plot results
ggplot(data=FloristicSurveyLDAval,aes(x=LD1, y=LD2, group=FloristicSurveysmall$GM_Coverage_category[1:189]))+
stat_ellipse(geom="polygon",aes(colour=FloristicSurveysmall$GM_Coverage_category[1:189]),fill=NA,size=1.2,alpha=0.3)+
stat_ellipse(geom="polygon",aes(fill=FloristicSurveysmall$GM_Coverage_category[1:189],colour=FloristicSurveysmall$GM_Coverage_category[1:189]),size=1.2,alpha=0.3)+
geom_point(aes(shape=FloristicSurveysmall$GM_Coverage_category[1:189],fill=FloristicSurveysmall$GM_Coverage_category[1:189],colour=FloristicSurveysmall$GM_Coverage_category[1:189]),size=I(4),alpha=I(0.8))+
xlab("LD Axis 1")+ylab("LD Axis 2")+theme_simple() +
theme(legend.title=element_blank())
length(FloristicSurveyLDAval$LD1)
# Plot results
ggplot(data=FloristicSurveyLDAval,aes(x=LD1, y=LD2, group=FloristicSurveysmall$GM_Coverage_category))+
stat_ellipse(geom="polygon",aes(colour=FloristicSurveysmall$GM_Coverage_category),fill=NA,size=1.2,alpha=0.3)+
stat_ellipse(geom="polygon",aes(fill=FloristicSurveysmall$GM_Coverage_category,colour=FloristicSurveysmall$GM_Coverage_category),size=1.2,alpha=0.3)+
geom_point(aes(shape=FloristicSurveysmall$GM_Coverage_category,fill=FloristicSurveysmall$GM_Coverage_category,colour=FloristicSurveysmall$GM_Coverage_category),size=I(4),alpha=I(0.8))+
xlab("LD Axis 1")+ylab("LD Axis 2")+theme_simple() +
theme(legend.title=element_blank())
# Plot results
ggplot(data=FloristicSurveyLDAval,aes(x=LD1,y=LD2,group=FloristicSurveysmall$GM_Coverage_category))+
stat_ellipse(geom="polygon",aes(colour=FloristicSurveysmall$GM_Coverage_category),fill=NA,size=1.2,alpha=0.3)+
stat_ellipse(geom="polygon",aes(fill=FloristicSurveysmall$GM_Coverage_category[1:189],colour=FloristicSurveysmall$GM_Coverage_category),size=1.2,alpha=0.3)+
geom_point(aes(shape=FloristicSurveysmall$GM_Coverage_category,fill=FloristicSurveysmall$GM_Coverage_category,colour=FloristicSurveysmall$GM_Coverage_category),size=I(4),alpha=I(0.8))+
xlab("LD Axis 1")+ylab("LD Axis 2")+theme_simple() +
theme(legend.title=element_blank())
# Plot results
ggplot(data=FloristicSurveyLDAval,aes(x=LD1,y=LD2,group=FloristicSurveysmall$GM_Coverage_category))+
stat_ellipse(geom="polygon",aes(colour=FloristicSurveysmall$GM_Coverage_category),fill=NA,size=1.2,alpha=0.3)+
stat_ellipse(geom="polygon",aes(fill=FloristicSurveysmall$GM_Coverage_category,colour=FloristicSurveysmall$GM_Coverage_category),size=1.2,alpha=0.3)+
geom_point(aes(shape=FloristicSurveysmall$GM_Coverage_category,fill=FloristicSurveysmall$GM_Coverage_category,colour=FloristicSurveysmall$GM_Coverage_category),size=I(4),alpha=I(0.8))+
xlab("LD Axis 1")+ylab("LD Axis 2")+theme_simple() +
theme(legend.title=element_blank())
#LDA
FloristicSurveysmall<-data.frame(FloristicSurvey[,4:56])
FloristicSurveysmall <- FloristicSurveysmall[,-c(42,45)]
FloristicSurveyLDA <- lda(GM_Coverage_category ~., data=FloristicSurveysmall)
# Extract scaling vectors
scalvec<-data.frame(FloristicSurveyLDA$scaling)
# Extract predictions
FloristicSurveyLDAval <- data.frame(predict(FloristicSurveyLDA)$x)
# Plot results
ggplot(data=FloristicSurveyLDAval,aes(x=LD1, y=LD2, group=FloristicSurveysmall$GM_Coverage_category))+
stat_ellipse(geom="polygon",aes(colour=FloristicSurveysmall$GM_Coverage_category),fill=NA,size=1.2,alpha=0.3)+
stat_ellipse(geom="polygon",aes(fill=FloristicSurveysmall$GM_Coverage_category,colour=FloristicSurveysmall$GM_Coverage_category),size=1.2,alpha=0.3)+
geom_point(aes(shape=FloristicSurveysmall$GM_Coverage_category,fill=FloristicSurveysmall$GM_Coverage_category,colour=FloristicSurveysmall$GM_Coverage_category),size=I(4),alpha=I(0.8))+
xlab("LD Axis 1")+ylab("LD Axis 2")+theme_simple() +
theme(legend.title=element_blank())
# Plot results
ggplot(data=FloristicSurveyLDAval,aes(x=LD1, y=LD2, group=FloristicSurveysmall$GM_Coverage_category))+
stat_ellipse(geom="polygon",aes(colour=FloristicSurveysmall$GM_Coverage_category),fill=NA,size=1.2,alpha=0.3)+
stat_ellipse(geom="polygon",aes(fill=FloristicSurveysmall$GM_Coverage_category,colour=FloristicSurveysmall$GM_Coverage_category),size=1.2,alpha=0.3)+
geom_point(aes(shape=FloristicSurveysmall$GM_Coverage_category,fill=FloristicSurveysmall$GM_Coverage_category,colour=FloristicSurveysmall$GM_Coverage_category),size=I(4),alpha=I(0.8))+
xlab("LD Axis 1")+ylab("LD Axis 2")+theme_simple() +
theme(legend.title=element_blank())
#test significance of axis
anova(lm(FloristicSurveyLDAval$LD1~FloristicSurveysmall$GM_Coverage_category[1:189]))
#LDA
FloristicSurveysmall<-data.frame(FloristicSurvey[,4:56])
FloristicSurveysmall <- FloristicSurveysmall[,-c(42,45)]
FloristicSurveyLDA <- lda(GM_Coverage_category ~., data=FloristicSurveysmall)
# Extract scaling vectors
scalvec<-data.frame(FloristicSurveyLDA$scaling)
# Extract predictions
FloristicSurveyLDAval <- data.frame(predict(FloristicSurveyLDA)$x)
# Plot results
ggplot(data=FloristicSurveyLDAval,aes(x=LD1, y=LD2, group=FloristicSurveysmall$GM_Coverage_category))+
stat_ellipse(geom="polygon",aes(colour=FloristicSurveysmall$GM_Coverage_category),fill=NA,size=1.2,alpha=0.3)+
stat_ellipse(geom="polygon",aes(fill=FloristicSurveysmall$GM_Coverage_category,colour=FloristicSurveysmall$GM_Coverage_category),size=1.2,alpha=0.3)+
geom_point(aes(shape=FloristicSurveysmall$GM_Coverage_category,fill=FloristicSurveysmall$GM_Coverage_category,colour=FloristicSurveysmall$GM_Coverage_category),size=I(4),alpha=I(0.8))+
xlab("LD Axis 1")+ylab("LD Axis 2")+theme_simple() +
theme(legend.title=element_blank())
# Plot results
ggplot(data=FloristicSurveyLDAval,aes(x=LD1, y=LD2, group=FloristicSurveysmall$GM_Coverage_category))+
stat_ellipse(geom="polygon",aes(colour=FloristicSurveysmall$GM_Coverage_category),fill=NA,size=1.2,alpha=0.3)+
stat_ellipse(geom="polygon",aes(fill=FloristicSurveysmall$GM_Coverage_category,colour=FloristicSurveysmall$GM_Coverage_category),size=1.2,alpha=0.3)+
geom_point(aes(shape=FloristicSurveysmall$GM_Coverage_category,fill=FloristicSurveysmall$GM_Coverage_category,colour=FloristicSurveysmall$GM_Coverage_category),size=I(4),alpha=I(0.8))+
xlab("LD Axis 1")+ylab("LD Axis 2")+theme_simple() +
theme(legend.title=element_blank())
#test significance of axis
anova(lm(FloristicSurveyLDAval$LD1~FloristicSurveysmall$GM_Coverage_category))
anova(lm(FloristicSurveyLDAval$LD2~FloristicSurveysmall$GM_Coverage_category))
#LDA WITHOUT A. PETIOLATA
FloristicSurveysmall<-data.frame(FloristicSurvey[,4:56])
# Linear discriminant function analysis
FloristicSurveysmall[10]<-NULL
FloristicSurveysmall[c(41,44)] <- NULL
FloristicSurveyLDA<-lda(GM_Coverage_category ~ ., data=FloristicSurveysmall)
# Extract scaling vectors
scalvec<-data.frame(FloristicSurveyLDA$scaling)
# Extract predictions
FloristicSurveyLDAval <- data.frame(predict(FloristicSurveyLDA)$x)
par(mar = rep(2, 4))
ldahist(data = FloristicSurveyLDAval[,1], g=FloristicSurveysmall$GM_Coverage_category)
# Plot results
ggplot(data=FloristicSurveyLDAval,aes(x=LD1,y=LD2,group=FloristicSurveysmall$GM_Coverage_category))+
stat_ellipse(geom="polygon",aes(colour=FloristicSurveysmall$GM_Coverage_category),fill=NA,size=1.2,alpha=0.3)+
stat_ellipse(geom="polygon",aes(fill=FloristicSurveysmall$GM_Coverage_category,colour=FloristicSurveysmall$GM_Coverage_category),size=1.2,alpha=0.3)+
geom_point(aes(shape=FloristicSurveysmall$GM_Coverage_category,fill=FloristicSurveysmall$GM_Coverage_category,colour=FloristicSurveysmall$GM_Coverage_category),size=I(4),alpha=I(0.8))+
xlab("LD Axis 1")+ylab("LD Axis 2")+theme_simple() +
theme(legend.title=element_blank())
# Extract predictions
FloristicSurveyLDAval <- data.frame(predict(FloristicSurveyLDA)$x)
# Plot results
ggplot(data=FloristicSurveyLDAval,aes(x=LD1,y=LD2,group=FloristicSurveysmall$GM_Coverage_category))+
stat_ellipse(geom="polygon",aes(colour=FloristicSurveysmall$GM_Coverage_category),fill=NA,size=1.2,alpha=0.3)+
stat_ellipse(geom="polygon",aes(fill=FloristicSurveysmall$GM_Coverage_category,colour=FloristicSurveysmall$GM_Coverage_category),size=1.2,alpha=0.3)+
geom_point(aes(shape=FloristicSurveysmall$GM_Coverage_category,fill=FloristicSurveysmall$GM_Coverage_category,colour=FloristicSurveysmall$GM_Coverage_category),size=I(4),alpha=I(0.8))+
xlab("LD Axis 1")+ylab("LD Axis 2")+theme_simple() +
theme(legend.title=element_blank())
# Plot results
ggplot(data=FloristicSurveyLDAval,aes(x=LD1,y=LD2,group=FloristicSurveysmall$GM_Coverage_category))+
stat_ellipse(geom="polygon",aes(colour=FloristicSurveysmall$GM_Coverage_category),fill=NA,size=1.2,alpha=0.3)+
stat_ellipse(geom="polygon",aes(fill=FloristicSurveysmall$GM_Coverage_category,colour=FloristicSurveysmall$GM_Coverage_category),size=1.2,alpha=0.3)+
geom_point(aes(shape=FloristicSurveysmall$GM_Coverage_category,fill=FloristicSurveysmall$GM_Coverage_category,colour=FloristicSurveysmall$GM_Coverage_category),size=I(4),alpha=I(0.8))+
xlab("LD Axis 1")+ylab("LD Axis 2")+theme_simple() +
theme(legend.title=element_blank())
#test significance of axis
anova(lm(FloristicSurveyLDAval$LD1~FloristicSurveysmall$GM_Coverage_category[1:189]))
Soil_characteristics$Location<-as.factor(Soil_characteristics$Location)
GLmodel_soil <- glm(Location ~Agg_stability*C_per_ug*N_per_ug,family=binomial(link='logit'),data=Soil_characteristics)
View(Soil_characteristics)
Location
GLmodel_soil <- glm(Location ~Agg_stability*C_per_ug*N_per_ug,family=binomial(link='logit'),data=Soil_characteristics)
GLmodel_soil <- glm(Location ~Agg_stability*C_perent*N_percent,family=binomial(link='logit'),data=Soil_characteristics)
GLmodel_soil <- glm(Location ~Agg_stability*C_percent*N_percent,family=binomial(link='logit'),data=Soil_characteristics)
summary(GLmodel_soil)
Soil_characteristics2 <- data.frame(Soil_characteristics$Population, Soil_characteristics$Location, log(Soil_characteristics$pH), log(Soil_characteristics$Agg_stability), log(Soil_characteristics$C_per_ug), log(Soil_characteristics$N_per_ug))
Soil_characteristics2 <- data.frame(Soil_characteristics$Population, Soil_characteristics$Location, log(Soil_characteristics$pH), log(Soil_characteristics$Agg_stability), log(Soil_characteristics$C_percent), log(Soil_characteristics$N_percent))
Soil_characteristics2<-rename(Soil_characteristics2, c("Soil_characteristics.Population"="Population", "Soil_characteristics.Location"="Location", "log.Soil_characteristics.pH."="pH", "log.Soil_characteristics.Agg_stability."="Agg_stability", "log.Soil_characteristics.C_percent."="Percent","log.Soil_characteristics.N_percent."="Percent" ))
df2<-melt(Soil_characteristics2,id.var=c("Population","Location"))
View(Soil_characteristics2)
df2 <- melt(Soil_characteristics2, id.var=c("Population","Location"))
Soil_characteristics2
df2 <- melt(Soil_characteristics2, id.var=c("Population","Location"))
melt
df2 <- tidyverse::melt(Soil_characteristics2, id.var=c("Population","Location"))
df2 <- reshape2::melt(Soil_characteristics2, id.var=c("Population","Location"))
df2 <- rename(df2, c("value"="Log_value"))
p <- ggplot(Soil_characteristics, aes(Location,pH,fill=Location))
p + geom_boxplot() +
theme_simple()
p + geom_boxplot() +
theme_simple()+
scale_color_brewer(palette="Dark2")
p + geom_boxplot() +
theme_simple()+
scale_color_brewer(palette="Dark2")
p <- ggplot(Soil_characteristics, aes(Location,pH,fill=Location))
p + geom_boxplot() +
theme_simple()+
scale_color_brewer(palette="Dark2")
# Fix column characteristics for plotting and analysis
fdata$indiv2<-as.factor(fdata$indiv2)
fdata$Mycorrhiza<-as.numeric(paste(fdata$Mycorrhiza))
fdata$Lesion<-as.numeric(paste(fdata$Lesion))
fdata$Herbivory<-as.numeric(paste(fdata$Herbivory))
pct<-function(x){
sum(x)/100
}
# Calculate plant-level averages
fdat_ind<-aggregate(fdata[,c("Mycorrhiza","Lesion","Herbivory")],by=list(indiv2=fdata$indiv2,pop=fdata$pop,loc=fdata$loc,species=fdata$species, pct))
# Calculate plant-level averages
fdat_ind<-aggregate(fdata[,c("Mycorrhiza","Lesion","Herbivory")],by=list(indiv2=fdata$indiv2,pop=fdata$pop,loc=fdata$loc,species=fdata$species, pct))
fdat_ind
fdat_ind
fdata
pct
# Calculate plant-level averages
fdat_ind<-aggregate(fdata[,c("Mycorrhiza","Lesion","Herbivory")],by=list(indiv2=fdata$indiv2,pop=fdata$pop,loc=fdata$loc,species=fdata$species, FUN=pct))
fdata[,c("Mycorrhiza","Lesion","Herbivory")]
# Calculate plant-level averages
fdat_ind<-aggregate(fdata[,c("Mycorrhiza","Lesion","Herbivory")],by=list(indiv2=fdata$indiv2,pop=fdata$pop,loc=fdata$loc,species=fdata$species), FUN=pct)
# Calculate plant-level averages
fdat_ind<-aggregate(fdata[,c("Mycorrhiza","Lesion","Herbivory")],by=list(indiv2=fdata$indiv2,pop=fdata$pop,loc=fdata$loc,species=fdata$species), FUN=pct))
# Calculate plant-level averages
fdat_ind<-aggregate(fdata[,c("Mycorrhiza","Lesion","Herbivory")],by=list(indiv2=fdata$indiv2,pop=fdata$pop,loc=fdata$loc,species=fdata$species, pct))
# Calculate plant-level averages
fdat_ind<-aggregate(fdata[,c("Mycorrhiza","Lesion","Herbivory")],by=list(indiv2=fdata$indiv2,pop=fdata$pop,loc=fdata$loc,species=fdata$species, FUN=pct))
pct<-function(x){
sum(x)/100
}
# Calculate plant-level averages
fdat_ind<-aggregate(fdata[,c("Mycorrhiza","Lesion","Herbivory")],by=list(indiv2=fdata$indiv2,pop=fdata$pop,loc=fdata$loc,species=fdata$species, FUN=pct))
# Calculate plant-level averages
fdat_ind<-aggregate(fdata[,c("Mycorrhiza","Lesion","Herbivory")],by=list(indiv2=fdata$indiv2,pop=fdata$pop,loc=fdata$loc,species=fdata$species), FUN=pct))
# Calculate plant-level averages
fdat_ind<-aggregate(fdata[,c("Mycorrhiza","Lesion","Herbivory")],by=list(indiv2=fdata$indiv2,pop=fdata$pop,loc=fdata$loc,species=fdata$species), FUN=pct)
